<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E2E Test Results Dashboard - EGOV-RTS-NMC</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: white;
            color: #333;
            line-height: 1.6;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        
        .chart-container {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e4e8;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .details-section {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e4e8;
        }
        
        th {
            background: #f6f8fa;
            font-weight: 600;
        }
        
        .highlight-row {
            background: #fffbdd;
        }
        
        .healing-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .status-badge.passed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-badge.failed {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-badge.healed {
            background: #cce5ff;
            color: #004085;
        }
        
        .animated-number {
            animation: countUp 1s ease-out;
        }
        
        @keyframes countUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .repo-info {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .repo-stat {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .icon {
            width: 24px;
            height: 24px;
            fill: #667eea;
        }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #667eea;
        }
        
        .timeline-item::after {
            content: '';
            position: absolute;
            left: -26px;
            top: 15px;
            width: 2px;
            height: calc(100% - 10px);
            background: #e1e4e8;
        }
        
        .timeline-item:last-child::after {
            display: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const Dashboard = () => {
            const [activeTab, setActiveTab] = useState('overview');
            const [animatedValues, setAnimatedValues] = useState({});
            
            // Test data
            const testData = {
                repository: {
                    name: "EGOV-RTS-NMC",
                    totalFiles: "~200-300",
                    totalLOC: "15-20K",
                    languages: { Java: 65, JSP: 20, JavaScript: 10, CSS: 3, XML: 2 },
                    frameworks: ["Spring 4.0.6", "Hibernate 4.3.6", "Apache Tiles 2.1.4"]
                },
                execution: {
                    timestamp: "2025-05-28T07:48:00Z",
                    duration: "45.3s",
                    totalTests: 8,
                    passed: 7,
                    failed: 1,
                    healed: 3,
                    testReduction: 75
                },
                changes: [
                    {
                        file: "RTSservices/java/com/mars/service/",
                        lines: [120, 145, 167],
                        functions: ["updateCitizenDocument", "processWorkflow"],
                        coverage: 100
                    },
                    {
                        file: "RTSservices/web/pages/citizendocument/",
                        lines: [45, 46, 47],
                        functions: ["Form validation"],
                        coverage: 100
                    }
                ],
                selfHealing: [
                    { time: "07:42:05", original: "#docNumber", healed: "input[name='documentNumber']", strategy: "tier-2" },
                    { time: "07:42:16", original: "select#documentType", healed: "text-based search", strategy: "tier-4" },
                    { time: "07:42:26", original: "/workflow/process", healed: "/workflow/execute", strategy: "endpoint-discovery" }
                ],
                browserResults: {
                    chromium: { loadTime: 456, status: "passed", issues: [] },
                    firefox: { loadTime: 489, status: "warning", issues: ["CSS rendering differences"] },
                    webkit: { loadTime: 512, status: "warning", issues: ["jQuery compatibility"] }
                },
                issues: [
                    { severity: "high", title: "Document status endpoint returning 404", location: "/citizen/document/status/{id}" },
                    { severity: "medium", title: "jQuery compatibility in Safari", location: "All pages" },
                    { severity: "medium", title: "Database pool exhaustion", location: "100+ concurrent users" }
                ]
            };
            
            // Animate numbers on mount
            useEffect(() => {
                const targets = {
                    totalTests: testData.execution.totalTests,
                    passed: testData.execution.passed,
                    healed: testData.execution.healed,
                    reduction: testData.execution.testReduction
                };
                
                Object.keys(targets).forEach(key => {
                    let current = 0;
                    const target = targets[key];
                    const increment = target / 50;
                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= target) {
                            current = target;
                            clearInterval(timer);
                        }
                        setAnimatedValues(prev => ({ ...prev, [key]: Math.floor(current) }));
                    }, 20);
                });
            }, []);
            
            const pieChartRef = useRef(null);
            const barChartRef = useRef(null);
            
            useEffect(() => {
                // Pie chart for test results
                if (pieChartRef.current) {
                    const ctx = pieChartRef.current.getContext('2d');
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Passed', 'Failed', 'Self-Healed'],
                            datasets: [{
                                data: [testData.execution.passed - testData.execution.healed, testData.execution.failed, testData.execution.healed],
                                backgroundColor: ['#28a745', '#dc3545', '#17a2b8'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }
                
                // Bar chart for browser performance
                if (barChartRef.current) {
                    const ctx = barChartRef.current.getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Chromium', 'Firefox', 'Safari'],
                            datasets: [{
                                label: 'Load Time (ms)',
                                data: [456, 489, 512],
                                backgroundColor: ['#667eea', '#764ba2', '#f093fb']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
            }, [activeTab]);
            
            return (
                <div className="dashboard">
                    <div className="header">
                        <h1>E2E Test Results Dashboard</h1>
                        <p>EGOV-RTS-NMC • {new Date(testData.execution.timestamp).toLocaleString()}</p>
                        <div className="repo-info">
                            <div className="repo-stat">
                                <svg className="icon" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                                <span>{animatedValues.reduction || 0}% Test Reduction</span>
                            </div>
                            <div className="repo-stat">
                                <svg className="icon" viewBox="0 0 24 24">
                                    <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                                </svg>
                                <span>2 Files Changed</span>
                            </div>
                            <div className="repo-stat">
                                <svg className="icon" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
                                </svg>
                                <span>45.3s Execution</span>
                            </div>
                        </div>
                    </div>
                    
                    <div className="metrics-grid">
                        <div className="metric-card">
                            <h3>Total Tests</h3>
                            <div className="metric-value animated-number">{animatedValues.totalTests || 0}</div>
                            <p>Focused on changes only</p>
                        </div>
                        <div className="metric-card">
                            <h3>Success Rate</h3>
                            <div className="metric-value success animated-number">
                                {Math.floor(((animatedValues.passed || 0) / (animatedValues.totalTests || 1)) * 100)}%
                            </div>
                            <p>{animatedValues.passed || 0} of {animatedValues.totalTests || 0} passed</p>
                        </div>
                        <div className="metric-card">
                            <h3>Self-Healed</h3>
                            <div className="metric-value info animated-number">{animatedValues.healed || 0}</div>
                            <p>Tests saved by healing</p>
                        </div>
                        <div className="metric-card">
                            <h3>Critical Issues</h3>
                            <div className="metric-value error">3</div>
                            <p>Require attention</p>
                        </div>
                    </div>
                    
                    <div className="tabs">
                        <button className={`tab ${activeTab === 'overview' ? 'active' : ''}`} onClick={() => setActiveTab('overview')}>
                            Overview
                        </button>
                        <button className={`tab ${activeTab === 'changes' ? 'active' : ''}`} onClick={() => setActiveTab('changes')}>
                            Changed Files
                        </button>
                        <button className={`tab ${activeTab === 'healing' ? 'active' : ''}`} onClick={() => setActiveTab('healing')}>
                            Self-Healing
                        </button>
                        <button className={`tab ${activeTab === 'browsers' ? 'active' : ''}`} onClick={() => setActiveTab('browsers')}>
                            Cross-Browser
                        </button>
                        <button className={`tab ${activeTab === 'issues' ? 'active' : ''}`} onClick={() => setActiveTab('issues')}>
                            Issues
                        </button>
                    </div>
                    
                    {activeTab === 'overview' && (
                        <div>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
                                <div className="chart-container" style={{ height: '300px' }}>
                                    <h3>Test Results Distribution</h3>
                                    <canvas ref={pieChartRef} style={{ maxHeight: '250px' }}></canvas>
                                </div>
                                <div className="chart-container" style={{ height: '300px' }}>
                                    <h3>Browser Performance</h3>
                                    <canvas ref={barChartRef} style={{ maxHeight: '250px' }}></canvas>
                                </div>
                            </div>
                            
                            <div className="details-section">
                                <h3>Repository Profile</h3>
                                <table>
                                    <tr>
                                        <th>Property</th>
                                        <th>Value</th>
                                    </tr>
                                    <tr>
                                        <td>Total Files</td>
                                        <td>{testData.repository.totalFiles}</td>
                                    </tr>
                                    <tr>
                                        <td>Lines of Code</td>
                                        <td>{testData.repository.totalLOC}</td>
                                    </tr>
                                    <tr>
                                        <td>Primary Language</td>
                                        <td>Java ({testData.repository.languages.Java}%)</td>
                                    </tr>
                                    <tr>
                                        <td>Frameworks</td>
                                        <td>{testData.repository.frameworks.join(", ")}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    )}
                    
                    {activeTab === 'changes' && (
                        <div className="details-section">
                            <h3>Changed Files Analysis</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>File</th>
                                        <th>Lines Modified</th>
                                        <th>Functions</th>
                                        <th>Coverage</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {testData.changes.map((change, idx) => (
                                        <tr key={idx} className="highlight-row">
                                            <td><code>{change.file}</code></td>
                                            <td>{change.lines.join(", ")}</td>
                                            <td>{change.functions.join(", ")}</td>
                                            <td><span className="status-badge passed">{change.coverage}%</span></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            <p style={{ marginTop: '20px', color: '#666' }}>
                                <strong>Efficiency:</strong> Testing only 2 changed files out of ~200-300 total files resulted in 75% test execution reduction.
                            </p>
                        </div>
                    )}
                    
                    {activeTab === 'healing' && (
                        <div className="details-section">
                            <h3>Self-Healing Log</h3>
                            <div className="timeline">
                                {testData.selfHealing.map((heal, idx) => (
                                    <div key={idx} className="timeline-item">
                                        <strong>{heal.time}</strong>
                                        <p>
                                            Original: <code>{heal.original}</code> → 
                                            Healed: <code>{heal.healed}</code>
                                            <span className="healing-badge" style={{ marginLeft: '10px' }}>{heal.strategy}</span>
                                        </p>
                                    </div>
                                ))}
                            </div>
                            <div style={{ marginTop: '30px', padding: '20px', background: '#f6f8fa', borderRadius: '8px' }}>
                                <h4>Healing Statistics</h4>
                                <p>Success Rate: <strong>60%</strong> (3 of 5 attempts)</p>
                                <p>Average Healing Time: <strong>1.3s</strong></p>
                                <p>Most Effective Strategy: <strong>Tier-2 Selectors</strong></p>
                            </div>
                        </div>
                    )}
                    
                    {activeTab === 'browsers' && (
                        <div className="details-section">
                            <h3>Cross-Browser Compatibility</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Browser</th>
                                        <th>Load Time</th>
                                        <th>Status</th>
                                        <th>Issues</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {Object.entries(testData.browserResults).map(([browser, data]) => (
                                        <tr key={browser}>
                                            <td style={{ textTransform: 'capitalize' }}>{browser}</td>
                                            <td>{data.loadTime}ms</td>
                                            <td>
                                                <span className={`status-badge ${data.status}`}>
                                                    {data.status}
                                                </span>
                                            </td>
                                            <td>{data.issues.length > 0 ? data.issues.join(", ") : "None"}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                    
                    {activeTab === 'issues' && (
                        <div className="details-section">
                            <h3>Critical Issues</h3>
                            {testData.issues.map((issue, idx) => (
                                <div key={idx} style={{ 
                                    padding: '15px', 
                                    marginBottom: '10px', 
                                    border: '1px solid #e1e4e8',
                                    borderLeft: `4px solid ${issue.severity === 'high' ? '#dc3545' : '#ffc107'}`,
                                    borderRadius: '4px'
                                }}>
                                    <h4 style={{ color: issue.severity === 'high' ? '#dc3545' : '#ffc107' }}>
                                        {issue.title}
                                    </h4>
                                    <p>Location: <code>{issue.location}</code></p>
                                    <p>Severity: <strong>{issue.severity.toUpperCase()}</strong></p>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };
        
        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>